# 第二章 第一节 数字进阶

本节课我们会系统性的学习数字

## 数字的内部表示方法

### 二进制表示与位运算

众所周知，计算机内部使用二进制来表示数字，因此我们不难想象，`2`在计算机中被表示为`10`。而直接针对二进制位来进行运算的方法被称为位运算，我们在第一节课已经接触过位运算的操作符，即`>>`, `<<`, `|`, `&`, `^`, `~`, 以及相应的赋值符号，接下来我们一一解释其用途。

首先是 `<<` 和 `>>` 这两个运算符被称为左移/右移运算符，顾名思义，是将一个数的二进制表示的位进行左移/右移，对于右移的情况，最右侧的一位会消失，一些情况下，`>> 1` 会当作`用2整除`使用

```js
2 >> 1 // 1 (10 -> 1)
3 >> 1 // 1 (11 -> 1)
2 << 1 // 4 (10 -> 100)
```

`|`运算符被称为`按位或`，这个运算符可以将两个数按照它们的二进制表示，一位一位进行`或`的运算，也就是说，两个数中任何一个数的某一位是`1`则结果的这一位就是`1`

```js
1 | 2 // 3 (1 | 10 -> 11)
```

`&`运算符被称为`按位与`，这个运算符可以将两个数按照它们的二进制表示，一位一位进行`与`的运算，也就是说，两个数的某一位都是`1`则结果的这一位才是`1`

```js
3 & 2 // 2 (11 & 10 -> 10)
```

`^`运算符被称为`异或`运算符，这个运算符可以将两个数按照它们的二进制，一位一位进行`异或`的运算（也许你玩过一个叫[异或之](https://h5mota.com/tower/?name=xor)的塔），`异或`的意思是，两个数的某一位不同，则结果中的这一位为`1`

```js
3 ^ 2 // 1 (11 ^ 10 -> 1)
```

`~`运算符被称为`取反`运算符，这个运算符可以将一个数的所有二进制位翻转，因此你对`1`进行取反会得到。。。`-2`！这里面包含了更加深奥的知识，也许你已经注意到我们刚刚没有谈负数的事情，实际上，现代计算机往往采用一种叫做补码的方式表示负数，它将最高位为`1`的数表示为负数，但是`-1`并非是`10000000 00000000 00000000 00000001`，而是`11111111 11111111 11111111 11111111`，因为这样的话，正数和负数的顺序就是一样的了（否则-1会在正负数上产生相反的结果）。

```js
~1 // -2  (11111111 11111111 11111111 11111110)
```

这个操作符有两个常见用途，一个是`~-1`，以获得0（很多api会将-1作为错误结果，但是只有0能转换为false）另外一个用途是，将数字取整：`~~1.1`（注意到一个数取反两次就等于它本身）不过这有一些限制。

也许你已经数过这几串数字，发现它的长度是`32`，这意味着，一旦你使用这几个运算符，你的数就会转换为`32`位数，因此对于大于`2^31-1`或者小于`2^31`的数，得到的结果不会如你所愿。

也许你对这部分内容感到很迷惑，不过不用担心，这组API在实际开发中很少用到，它们是来自C语言的遗留，所以就像C语言一样，暴露了大量的计算机本质，高性能，但是难以使用。

### 浮点数及其表示限制

很明显，上面写的这种方法只能用来表示整数，人们要如何用二进制来表示小数呢？一种常见的方案是将数表示为两个数相除，这种方案被称为浮点数。js使用的浮点数标准为`IEEE 754双精度浮点数`，具体来说，它有`64`位，其中`52`个位用于表示分母，`11`个位被用于表示分母（分母实际上被表示为2的阶乘形式，范围为`2^(-1022)~2^1023`），剩下一个用来表示正负。

网上流传着一个经典的js大坑：`0.1 + 0.2 !== 0.3`，学过本节之后我们不难理解其原理：浮点数的分母是`2`的倍数，而`0.1`, `0.2`, `0.3`的分数形式中包含因子`5`，因此无法被准确表示。

除此之外，我们还可以知道其表示的限制，JS提供了三个可访问的常数 `Number.MAX_VALUE`,代表浮点数能表示的最大值，`Number.MIN_VALUE` 代表浮点数能表示的最小**精度**, `Number.MAX_SAFE_INTEGER` 代表浮点数能安全表示的最大整数，超过这个限制之后，多个整数会被表示为相同的值，例如说 `2 ** 1023 + 1 === 2 ** 1023`，可能会发生一些奇怪的错误

```js
Number.MAX_VALUE // 1.7976931348623157e+308 即 `2^1024 - 2^(1024-53)` 
Number.MIN_VALUE // 5e-324 即 `2^(-1022-52)`
Number.MAX_SAFE_INTEGER // `-2^53+1`~`2^53-1` 因为分子只有52个位，再加上一个符号位于是是53位
```

## 整型数字和浮点型数字

在之前的学习中，我们只知道数字就是数字，并没有进行划分。但是，这一次我们要对它进行划分，分为`整型数字`和`浮点型数字`两类

### 整型数字

整型数字，顾名思义，就是整数。例如`1` `1297`等。不过，整型数字有一个很大的缺点，就是可表示范围较小，是`Number.MIN_SAFE_INTEGER`\~`Number.MAX_SAFE_INTEGER`，直接在控制台输入这两个内容就可以知道范围了，转化成数字就是`-2^53+1`\~`2^53-1`。我们也不需要知道为什么是这两个数字，只需要知道整型数字有范围和范围的值就行了

### 浮点型数字

当然，整型数字不能满足我们计算的需求，所以，js还有浮点型数字这个东西，它可以表示小数，同时表示范围也更大，范围是`-Number.MAX_VALUE`\~`Number.MAX_VALUE`，最小表示精度为`Number.MIN_VALUE`，所以，浮点型数字在范围上有很大的优势。但是它也有不足的地方，那就是`浮点误差`。你可以试试再控制台输入`0.1 + 0.2 === 0.3`，它的结果会让你很惊讶，实际上，每个编程语言都不可避免这一点，并不是js独有的特性。如何避免暂且不说，会在第三次细讲的时候讲到

## 特殊数字

在js中，有两个特殊的数字——`NaN` 和 `Infinity`

### NaN

这个东西的全称是`Not a Number`，虽说看起来不是数，但是`typeof NaN === 'number'`（js：特性特性）

#### 判断是否为NaN

我们可以通过一个函数判断一个内容是否是NaN（不能使用 `number === NaN`，因为`NaN !== NaN`）

```js
var num = NaN;
console.log(isNaN(num)); // 输出true
```

没错，这个函数叫`isNaN(number)`，我们一般都会使用这个函数来判断一个数是不是NaN

#### 出现NaN的一般情况

1. 字符串 * 数字出现NaN
2. 字符串和数字相除
3. `Infinity` * 0
4. 一些非规范操作（一般是把数字和不是数字的值相互运算）

### Infinity

顾名思义，就是无限大。超过`Number.MAX_VALUE`就是`Infinity`，小于`-Number.MAX_VALUE`就是`-Infinity`。它有以下特性

1. 任何数和Infinity相加相减的结果都是Infinity
2. 除了0与Infinity相乘后为NaN外，其余数与Infinity相乘后都是Infinity，正负符号与正常运算相同
3. 除了`0 / Infinity`结果为0外，其余数与Infinity相除结果都是Infinity，正负符号与正常运算相同

## 数字的表示方法

### 朴素的数字

你可以使用最朴素的方法来表示数字——就好像你写数学作业的时候做的那样

```js
1
-1
0.1
.1 // 与上面一个相同 
```

### 科学计数法

如果读者上过高中的话，应该已经接触过科学记数法，或者也可以参考[百度百科](https://baike.baidu.com/item/%E7%A7%91%E5%AD%A6%E8%AE%B0%E6%95%B0%E6%B3%95/1612882)。在表示较大数量级的数字时，科学记数法非常好用(可以尝试速算1123412341234/712412343，跨数量级的比较中数字形式很难感知大小关系)

```js
1e10 // 就是1*10^10
2.23423e+123 // 就是2.23423*10^123
6.14364e-7 // 就是6.14364*10^-7
```

### 2进制和16进制

在特别的情况下，需要使用其他的进制来表达数字（例如说，二进制串可以当成一连串的布尔值使用，而在表示颜色的时候常用16进制字符串），js提供了2进制和16进制的字面量表示方法，你可以使用`0b`/`0B`开头的数字串来表示二进制(b = binary)，用`0x`/`0X`开头的字符串表示16进制串(x = hex)

```js
0b1 + 0b1 === 0b10 // true 典中典之 1+1 = 10 
-0b1 // 负号是加在最前面的
0x7F // = 127
0xFf // 可以混用大小写，但是小心被强迫症打（
```

## 数字可以使用的基础方法

这里需要我们掌握的数字方法有三个——`toString()` `toExponential()` `toFixed()`

### toString()

这个方法可以将数字转化为字符串。方法有一个参数，可以指定输出进制，范围是`2~36`

```js
var a = 12345;
console.log(a.toString()); // 输出黑色的12345，说明是字符串
console.log(a.toString(2)); // 输出黑色的11000000111001，说明是字符串
console.log(a.toString(16)); // 输出黑色的3039，说明是字符串
```

### toExponential()

这个方法可以将数字转化为科学计数法形式，并以字符串的形式返回。方法有一个参数，指定小数部分精确位数，末位四舍五入

```js
console.log((123).toExponential()); // 输出黑色的1.23e+2
console.log((123).toExponential(1)); // 输出黑色的1.2e+2
```

### toFixed()

这个方法会将数字转化为指定位数的小数，四舍五入末位，并以字符串形式返回。方法有一个参数，指定要精确的位数，范围是`0~100`

```js
console.log((123.456789).toFixed(3)); // 输出黑色的123.457
```

## 常用Math对象方法和属性

我们时常要进行数学运算，于是js就内置了一系列数学方法和属性

1. `Math.PI` 返回圆周率`3.141592653589793`
2. `Math.E` 返回自然常数`2.718281828459045`
3. `Math.SQRT2`返回根号2 `1.4142135623730951`
4. `Math.SQRT1_2`返回根号二分之一`0.7071067811865476`
5. `Math.floor(num)`对传入的数向下取整
6. `Math.ceil(num)`对传入的数向上取整
7. `Math.round(num)`对传入的数四舍五入
8. `Math.min(...num)`返回所有传入的数的最小值
9. `Math.max(...num)`返回所有传入的数的最大值
10. `Math.pow(x, y)`返回 `x ** y` 的结果
11. `Math.round()`返回一个随机数
12. `Math.sqrt(num)`返回传入数字的平方根，不必要情况下不建议使用，会影响性能，可用两边同时平方代替
13. `Math.cbrt(num)`返回立方根
14. `Math.abs(num)`返回绝对值
15. `Math.sign(num)`返回数字的符号，负数返回`-1`，0返回`0`，正数返回`1`
