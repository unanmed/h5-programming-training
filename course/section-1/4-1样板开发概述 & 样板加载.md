# 第四章 第一节 样板开发概述 & 样板加载

从本节课开始，我们就将进入到样板中（这应该是大部分学习者的主要目的）。不过，在我们实际开始讲解之前，请确认你已经学会了全部js知识，下载了一个样板，并安装了vscode。

## 样板结构

首先展示一下样板的整体目录结构（摘自样板的[github仓库](https://github.com/ckcz123/mota-js)）

``` bash
├── /_server/        # 为可视化地图编辑器提供一些支持的目录
├── /docs/           # 文档目录
├── /extensions/     # 拓展工具目录，发布到网站后不会加载
├── /libs/           # 系统库目录
│ ├─ /thirdparty/    # 游戏所用到的第三方库文件
│ ├─ actions.js      # 处理用户交互的文件
│ ├─ core.js         # 系统核心文件（游戏入口，接口&转发）
│ ├─ control.js      # 游戏逻辑控制
│ ├─ data.js         # 记录了一些初始化信息
│ ├─ enemys.js       # 记录了怪物的信息，包括特殊属性、伤害计算公式、临界值计算等。
│ ├─ events.js       # 处理事件的文件，所有自定义事件都会在此文件中进行处理
│ ├─ extensions.js   # 加载拓展工具的文件
│ ├─ icons.js        # 图标信息，会被转发到project下
│ ├─ items.js        # 道具信息，会被转发到project下
│ ├─ loader.js       # 动态加载JS代码、图片、音效等
│ ├─ maps.js         # 记录了地图信息，和地图绘制等操作
│ ├─ ui.js           # UI绘制信息，主要负责绘制各个UI窗口。
│ └─ utils.js        # 工具类
├── /project/        # 项目目录，用户需要在这里做自己的塔
│ ├─ /animates/      # 动画目录
│ ├─ /autotiles/     # 使用到的自动元件
│ ├─ /bgms/          # 使用到的背景音乐
│ ├─ /floors/        # 剧本文件，记录了每个地图的数据和事件
│ ├─ /fonts/         # 字体目录
│ ├─ /images/        # 游戏中使用到的图片目录
│ ├─ /materials/     # 系统素材目录
│ ├─ /sounds/        # 音效目录
│ ├─ /tilesets/      # 额外素材目录
│ ├─ data.js         # 全局变量信息
│ ├─ enemys.js       # 怪物属性数据
│ ├─ events.js       # 公共事件
│ ├─ functions.js    # 可能会被修改的脚本代码
│ ├─ icons.js        # 素材和ID的对应关系定义
│ ├─ items.js        # 道具的定义，获得道具的效果
│ ├─ maps.js         # 地图和数字的对应关系
│ └─ plugins.js      # 自定义插件
├── /常用工具/        # 一些常用工具，可以辅助造塔；具体可参见下面的【相关工具】
├── editor.html      # 可视化地图编辑工具
├── editor-mobile.html      # 可视化地图编辑工具（手机版）
├── index.html       # 主程序，游戏的入口
├── logo.png         # 启动游戏时显示的logo图标
├── main.js          # JS程序的入口，将动态对所需JS进行加载
├── runtime.d.js     # 样板运行时的类型标注
├── server.py        # 使用python编写的启动服务
├── style.css        # 游戏所需要用到的样式表
└── 启动服务.exe      # 一个本地的HTTP服务器，也能支撑前端的一些POST请求从而能拓展JS的IO功能。
```

在本章中，我们将集中于样板运行时相关的模块：

``` bash
├── /libs/           # 系统库目录
│ ├─ /thirdparty/    # 游戏所用到的第三方库文件
│ ├─ actions.js      # 处理用户交互的文件
│ ├─ core.js         # 系统核心文件（游戏入口，接口&转发）
│ ├─ control.js      # 游戏逻辑控制
│ ├─ data.js         # 记录了一些初始化信息
│ ├─ enemys.js       # 记录了怪物的信息，包括特殊属性、伤害计算公式、临界值计算等。
│ ├─ events.js       # 处理事件的文件，所有自定义事件都会在此文件中进行处理
│ ├─ extensions.js   # 加载拓展工具的文件
│ ├─ icons.js        # 图标信息，会被转发到project下
│ ├─ items.js        # 道具信息，会被转发到project下
│ ├─ loader.js       # 动态加载JS代码、图片、音效等
│ ├─ maps.js         # 记录了地图信息，和地图绘制等操作
│ ├─ ui.js           # UI绘制信息，主要负责绘制各个UI窗口。
│ └─ utils.js        # 工具类
├── /project/        # 项目目录，用户需要在这里做自己的塔
│ ├─ /animates/      # 动画目录
│ ├─ /autotiles/     # 使用到的自动元件
│ ├─ /bgms/          # 使用到的背景音乐
│ ├─ /floors/        # 剧本文件，记录了每个地图的数据和事件
│ ├─ /fonts/         # 字体目录
│ ├─ /images/        # 游戏中使用到的图片目录
│ ├─ /materials/     # 系统素材目录
│ ├─ /sounds/        # 音效目录
│ ├─ /tilesets/      # 额外素材目录
│ ├─ data.js         # 全局变量信息
│ ├─ enemys.js       # 怪物属性数据
│ ├─ events.js       # 公共事件
│ ├─ functions.js    # 可能会被修改的脚本代码
│ ├─ icons.js        # 素材和ID的对应关系定义
│ ├─ items.js        # 道具的定义，获得道具的效果
│ ├─ maps.js         # 地图和数字的对应关系
│ └─ plugins.js      # 自定义插件
├── index.html       # 主程序，游戏的入口
├── logo.png         # 启动游戏时显示的logo图标
├── main.js          # JS程序的入口，将动态对所需JS进行加载
├── style.css        # 游戏所需要用到的样式表
```

## 样板加载

作为样板讲解的第一个话题，我们首先讨论下样板的加载：在样板中我们可以使用各种图片，音乐，动画，字体，以及代码，这些东西是如何被提供的？这是一个很大的问题，因此我们将其拆分成多个部分。

### 页面加载

作为一个前端工程，样板的入口毫无疑问是 `index.html`。样板显示画面元素也都在这个文件中，如果你有 `html` 方面的知识，可以具体的查看这些内容。不过本节只关心这个文件是如何加载其他资源的：

首先可以看到的是第16行，在这行中，通过 `<link>` 标签引用了 `styles.css`，加载了样板的样式表：

```html
<!-- index.html:16 -->
<link type='text/css' href='styles.css' rel='stylesheet'>
```

不过，大家真正关心的内容在文件的最后：第191行开始，有六个`<script>` 标签，其中前四个引入了第三方开发的代码，其中 `lz-string.min.js` 是压缩字符串的库，用于压缩存档和录像，`priority-queue.min.js` 是`优先队列`(这是一种数据结构)的库，用于寻路功能，`localforage.min.js` 是本地存储相关的库，`zip.min.js` 则是解压游戏文件的库，我们在本节的后续部分就会展示它的实际使用。

更后面的两个是样板 js 的入口，`main.js` 指向样板根目录下的同名文件。最后一个`script`标签负责实际加载。

```html
<!-- index.html:191 -->
<script src='libs/thirdparty/lz-string.min.js'></script>
<script src='libs/thirdparty/priority-queue.min.js'></script>
<script src='libs/thirdparty/localforage.min.js'></script>
<script src='libs/thirdparty/zip.min.js'></script>
<script id='mainScript' src='main.js'></script>
<script>main.init('play');main.listen();</script>
```


