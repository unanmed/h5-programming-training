# 第一次答疑&教材修订

> 如果看的是修正的教材(有前言)，可以跳过此节，相关章节已经增加了相应的内容

经过5节课，codelab逐渐完善，教材也需要修正一下相关问题

本次修订将课程内容进行了一定的拆解，从五节课拉长到八节课，并补充了一部分知识和习题

以下将所有的改动列出（作业中列出所有新增的习题）

## arguments

使用 `arguments` 时可以用 `arguments.length` 获取参数的数量

## 数字的内部表示方法

### 二进制表示与位运算

众所周知，计算机内部使用二进制来表示数字，因此我们不难想象，`2`在计算机中被表示为`10`。而直接针对二进制位来进行运算的方法被称为位运算，我们在第一节课已经接触过位运算的操作符，即`>>`, `<<`, `|`, `&`, `^`, `~`, 以及相应的赋值符号，接下来我们一一解释其用途。

首先是 `<<` 和 `>>` 这两个运算符被称为左移/右移运算符，顾名思义，是将一个数的二进制表示的位进行左移/右移，对于右移的情况，最右侧的一位会消失，一些情况下，`>> 1` 会当作`用2整除`使用

```js
2 >> 1 // 1 (10 -> 1)
3 >> 1 // 1 (11 -> 1)
2 << 1 // 4 (10 -> 100)
```

`|`运算符被称为`按位或`，这个运算符可以将两个数按照它们的二进制表示，一位一位进行`或`的运算，也就是说，两个数中任何一个数的某一位是`1`则结果的这一位就是`1`

```js
1 | 2 // 3 (1 | 10 -> 11)
```

`&`运算符被称为`按位与`，这个运算符可以将两个数按照它们的二进制表示，一位一位进行`与`的运算，也就是说，两个数的某一位都是`1`则结果的这一位才是`1`

```js
3 & 2 // 2 (11 & 10 -> 10)
```

`^`运算符被称为`异或`运算符，这个运算符可以将两个数按照它们的二进制，一位一位进行`异或`的运算（也许你玩过一个叫[异或之](https://h5mota.com/tower/?name=xor)的塔），`异或`的意思是，两个数的某一位不同，则结果中的这一位为`1`

```js
3 ^ 2 // 1 (11 ^ 10 -> 1)
```

`~`运算符被称为`取反`运算符，这个运算符可以将一个数的所有二进制位翻转，因此你对`1`进行取反会得到。。。`-2`！这里面包含了更加深奥的知识，也许你已经注意到我们刚刚没有谈负数的事情，实际上，现代计算机往往采用一种叫做补码的方式表示负数，它将最高位为`1`的数表示为负数，但是`-1`并非是`10000000 00000000 00000000 00000001`，而是`11111111 11111111 11111111 11111111`，因为这样的话，正数和负数的顺序就是一样的了（否则-1会在正负数上产生相反的结果）。

```js
~1 // -2  (11111111 11111111 11111111 11111110)
```

这个操作符有两个常见用途，一个是`~-1`，以获得0（很多api会将-1作为错误结果，但是只有0能转换为false）另外一个用途是，将数字取整：`~~1.1`（注意到一个数取反两次就等于它本身）不过这有一些限制。

也许你已经数过这几串数字，发现它的长度是`32`，这意味着，一旦你使用这几个运算符，你的数就会转换为`32`位数，因此对于大于`2^31-1`或者小于`2^31`的数，得到的结果不会如你所愿。

也许你对这部分内容感到很迷惑，不过不用担心，这组API在实际开发中很少用到，它们是来自C语言的遗留，所以就像C语言一样，暴露了大量的计算机本质，高性能，但是难以使用。

### 浮点数及其表示限制

很明显，上面写的这种方法只能用来表示整数，人们要如何用二进制来表示小数呢？一种常见的方案是将数表示为两个数相除，这种方案被称为浮点数。js使用的浮点数标准为`IEEE 754双精度浮点数`，具体来说，它有`64`位，其中`52`个位用于表示分子，`11`个位被用于表示分母（分母实际上被表示为2的阶乘形式，范围为`2^(-1022)~2^1023`），剩下一个用来表示正负。

网上流传着一个经典的js大坑：`0.1 + 0.2 !== 0.3`，学过本节之后我们不难理解其原理：浮点数的分母是`2`的倍数，而`0.1`, `0.2`, `0.3`的分数形式中包含因子`5`，因此无法被准确表示。

除此之外，我们还可以知道其表示的限制，JS提供了三个可访问的常数 `Number.MAX_VALUE`,代表浮点数能表示的最大值，`Number.MIN_VALUE` 代表浮点数能表示的最小**精度**, `Number.MAX_SAFE_INTEGER` 代表浮点数能安全表示的最大整数，超过这个限制之后，多个整数会被表示为相同的值，例如说 `2 ** 1023 + 1 === 2 ** 1023`，可能会发生一些奇怪的错误

```js
Number.MAX_VALUE // 1.7976931348623157e+308 即 `2^1024 - 2^(1024-53)` 
Number.MIN_VALUE // 5e-324 即 `2^(-1022-52)`
Number.MAX_SAFE_INTEGER // `-2^53+1`~`2^53-1` 因为分子只有52个位，再加上一个符号位于是是53位
```

## 2进制和16进制

在特别的情况下，需要使用其他的进制来表达数字（例如说，二进制串可以当成一连串的布尔值使用，而在表示颜色的时候常用16进制字符串），js提供了2进制和16进制的字面量表示方法，你可以使用`0b`/`0B`开头的数字串来表示二进制(b = binary)，用`0x`/`0X`开头的字符串表示16进制串(x = hex)

```js
0b1 + 0b1 === 0b10 // true 典中典之 1+1 = 10 
-0b1 // 负号是加在最前面的
0x7F // = 127
0xFf // 可以混用大小写，但是小心被强迫症打（
```

## 立即执行函数 IIFE

在某些特殊情况下，我们会希望立即执行一个临时的函数，例如说，跳出多层循环：

```js
for (var i = 0; i < x; i++) {
    for (var j = 0; j < x; j++) {
        if (i + j === 10) {
            // 想在这里跳出，但是break只能跳出一层，很尴尬
        }
    }   
}
```

在这种时候，我们可以借助临时函数的`return`语句来解决问题

```js
(function() {
    for (var i = 0; i < x; i++) {
        for (var j = 0; j < x; j++) {
            if (i + j === 10) {
                return i*j; // 直接跳出两层
            }
        }   
    }
})();
```

这种形式被称为立即执行函数，简称`IIFE`，在编写`IIFE`时，声明的函数要用小括号包裹才能执行调用


## 箭头函数

> 截止目前，请不要在样板中使用这一语法，这个语法无法通过压缩

在2015年，js引入了一种新的声明函数的方法`箭头函数`，用于声明临时的，没有名字的函数

箭头函数的语法非常简单: `(参数) => { 函数体 }`，相当于`function (参数) { 函数体 }`

举例子：

```js
var myFunc = (x) => {
    return (y) => {
        return x + y;
    }
}
```

特别的，如果函数体只有一条语句，可以省略大括号，这条语句的值会做为整个函数的返回值

```js
// 改写上面的函数
var myFunc = (x) => {
    return (y) =>  x + y;
}
// 甚至可以这样！
var myFunc = (x) => ((y) => x + y);
```

箭头函数也可以作为`IIFE`，语法如下

```js
(() => {
    console.log("a");
})();
```

特别的，箭头函数中无法使用`arguments`来获取传入参数，从编程风格来说，推荐将所有具名的函数写成`function`形式，而作为参数或者返回值的函数则写成箭头函数形式

## 字符串方法

你可以通过在字符串后面加`.`的方式调用其内置方法，对于字符串变量，这个操作同样有效

### 获取字符编码 codePointAt

`codePointAt(x)` 接受一个数字参数`i`，返回第i个字符的编码

```js
"啊".codePointAt(0); // 21834
```

更多细节参见[mdn文档](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/codePointAt);

### 字符串查找 indexOf lastIndexOf includes startsWith endsWith

js提供了`indexOf(str, i)`方法，接受一个或者两个参数，用来搜索在字符串中`str`头一次出现的位置，如果搜索不到则返回`-1`，否则返回`str`开头字符的下标。如果传入了第二个参数`i`，则会从`i`开始向后查找

```js
"114514".indexOf("1"); // 0
"114514".indexOf("9"); // -1

"114514".indexOf("1", 3); // 4
```

js也提供了`lastIndexOf`方法用于查找字符串的最后一次出现，此时第二个参数则意味着字符串的右边界

```js
"114514".lastIndexOf("1"); // 4
"114514".lastIndexOf("9"); // -1

"114514".lastIndexOf("1", 3); // 1
```

如果你仅仅想知道字符串中是否有某个字符串出现，可以使用`includes`方法，这个方法与`indexOf !== -1`实质上相同

```js
"114514".includes("1"); // true
"114514".includes("9"); // false
```

如果你希望知道某个字符串是不是另一个字符串的前缀/后缀，可以使用`startsWith`/`endsWith`方法（你也可以用上面提到的方法来完成等价的效果

```js
"h5mota.com".startsWith("www"); // false
"h5mota.com".endsWith("com"); // true
```

### 字符串截取 substr substring slice

由于历史原因，js提供了三种方法来截取字符串，其中`substr()`已经被弃用，这里不再介绍

`substring(i, j)` 方法接受一个或两个数字参数，并返回原串第`i`个字符到第`j-1`个字符组成的子字符串(不改动原串)，如果不传入`j`，则返回`i`到字符串末尾这样一个后缀

```js
"123".substring(0, 2) // "12"
"123".substring(1) // "23" 
```

更多细节参见[mdn文档](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/substring);

`slice(i, j)`方法类似于`substring`的升级版，允许传入负数，代表倒数的第x个字符串，在某些情况下这非常方便，但是也容易产生错误

```js
"123".slice(0, 2) // "12"
"123".slice(1) // "23" 

"123".slice(-2, -1) // "2"
"123".slice(-1) // "23"
```

更多细节参见[mdn文档](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/slice);

### 大小写转换 toLowerCase toUpperCase

js提供了 `toLowerCase` `toUpperCase` 这一对方法来转换大小写

```js
"CODELAB".toLowerCase() // codelab
"codelab".toUpperCase() // CODELAB
```

### 字符串连接与分割 concat join split

你可以使用`concat`方法来连接多个字符串

```js
"1926".concat("08", "17") // 一个神秘的数字！
```

`join`方法与此类似，但是它是一个用于数组的方法，它接收一个字符串，将整个字符串数组连接起来，并在每两个字符串之间插入传入的字符串

```js
["1926", "08", "17"].join("") // 与上面相同
["1926", "08", "17"].join("x") // 1926x08x17  
```

反过来，js也提供了将字符串分割为数组的方法`split`，它和`join`恰巧是逆运算

```js
"1926x08x17".split("x") // ["1926", "08", "17"]
```

额外的，你可以传入一个数字控制切分的段数，多余的部分会被忽略掉

```js
"1926x08x17".split("x", 1) // [ "1926" ]
```

### 字符串替换 replace replaceAll

本节课最复杂的方法是字符串替换，js提供了`replace(str, func)`方法，它可以匹配一个字符串`str`，然后执行`func`，将原串中的`str`替换为`func`的返回值，当然，你也可以直接传入要替换的字符串

```js
"h5mota.com".replace("h5", "h6") // h6mota.com
"h5mota.com".replace("h5", () => "h6") // h6mota.com
```

更多细节参见[mdn文档](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace)

```js
"114514".replaceAll("14", "15") // 115515
"114514".replaceAll("14", () => "15") // 115515
```

更多细节参见[mdn文档](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replaceAll)

## 数组章节重构

将数组章节拆分为两节，并增设了一些习题，以及讲解，推荐全文阅读一次`2-5数组进阶`
