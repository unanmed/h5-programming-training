# 第一章 第五节 对象与数组

## 对象是啥

对象即 `Object` (这个词的出镜率还挺高的)，对象的标志性特征是它拥有属性(`property`)，或者，另一个称呼是键值对，也就是一个名称和对应的值。你可以用 `.名称` 来访问它的属性，属性的值可以是任何类型，例如说数字，字符串，或者另一个对象。

也许你对这个描述感到熟悉，是的实际上你已经接触过对象了，我们之前讲过 `console.log`，实际上它指的就是 `console` 对象的 `log` 属性。

```js
// 我们又回到这个语句了
console.log("hello world") // "hello world"
```

### 对象的声明和访问

如果你想自己声明一个对象，可以使用对象字面量`{}`，使用`{}`声明的对象是空的，里面什么都没有，因此如果你访问某个属性，会返回`undefined`，如果你需要设置一些初始的属性，可以使用这种语法`{ a: 1 }`，随后你就可以访问属性`a`了

```js
const obj1 = {};
obj1.a // undefined
const obj2 = { a: 1 };
obj2.a // 1
```

特别的，你可以用引号包裹属性名，以声明一些奇怪的属性名，例如说

```js
const obj3 = {
    "a/2": 1,
}
obj3.a/2 // 好像有什么不对劲的地方
```

如果你的属性名里包含了奇怪的字符，就无法直接用`.`来访问了，js提供了另外一种语法来访问对象的属性——使用下标运算符`[]`，特别的，你可以传入一个变量（就像数组那样），这提高了访问的自由度

```js
obj3["a/2"] // 1

const name = "a/2";
obj3[name];
```

### 遍历对象属性

可以使用`for in`语句来遍历对象的所有属性，就像下面这样

```js
const obj = { a: 1 }
for (const i in obj) {
    console.log(i, obj[i]);
}
// "a" 1
```

特别的，`in` 本身还是一个运算符，你可以用它来判断对象是否拥有某个属性

```js
"a" in { a: 1 } // true
```

> 注意这个运算符优先级比`!`低，因此你需要使用`!`时，要写成`!("a" in { a: 1 } )`而不是`!"a" in { a: 1 }`

## 对象的用法

js中的对象实际上是传统编程语言中`结构体`和`字典`的混合，因此一种用法是声明结构化的数据，每个属性代表不同的概念

```js
const user = {
    id: 1188,
    name: "老黄鸡",
}
console.log(user.name + "NB!") // 你知道我要说什么
```

而另外一种用法是作为字典，每个属性的值都是类似的东西

```js
const users = {
    ["1188"]: "老黄鸡",
    ["3387"]: "我是小姑娘",
}
users["3387"] = "伯伯";
```

## 数组

### 基本概念

一种特别的对象被称为数组，与对象不同的是，它的属性名称是从0开始的数字（这被称为下标），这使得它常用于存储有序内容。数组有自己的字面量`[]`，你可以像这样声明一个数组：

```js
const arr = [ 1, 2 ];
```

数组的属性被称为元素，访问元素的方法和访问对象属性类似，你可以这么操作：

```js
arr[0]; // 1 注意到这是 arr 的第一个元素
```

除此以外，数组还拥有一个特殊的属性 `length`，它代表数组的长度

```js
arr.length // 2
```

### 遍历数组

你可以用上面介绍过的 `for in` 语法来遍历数组（有趣的是，`length` 属性不会被遍历到）：

```js
for (const i in arr) {
    console.log(i); // "0" "1"
}
```

对于只想获取元素本身而不需要下标的情形，js 提供了另一个语法 `for of`，它只对数组生效：

```js
for (const elm of arr) {
    console.log(elm); // 1 2
}
```

> 这个语法是 es6 提出的，因此有兼容性问题

除此之外，还有一种 C语言 流传下来的经典写法：

```js
for (let i = 0; i < arr.length; i++) {
    console.log(i); // "0" "1"
}
```

奇妙的是，这种写法有最好的性能。

### 数组的简单方法

你可以使用 `push` 方法向一个数组的尾部追加元素，像这样：

```js
const a = [];
a.push(1);
console.log(a); // [1]
```

相对的，`pop` 方法可以将数组的末尾元素弹出：

```js
const b = [1];
const r = b.pop();
console.log(r); // 1
console.log(b); // [] 
```

### 元组

就好像我们将对象分为 `结构体` 和 `字典` 一样，数组也有两种不同的用法，我们刚刚展示的基本是类似 `字典` 的用法，但是你也可以将定长的数组当作结构体使用，其每个下标都对应一种数据。

## 值类型和引用类型

也许你已经注意到，我们在上面的演示中多次修改了用 `const` 声明的对象和数组的值，但是这却不会产生报错。实际上，js的数据类型分为值类型和引用类型，我们之前接触过的字符串，数字，布尔值，都是值类型，而函数和对象则是引用类型。值类型的特征是，当它被赋值给另外一个变量之后，会拷贝一份新的值，例如说：

```js
let a = "5";
let b = a;
a = "10";
console.log(b); // "5"
```

这是非常符合直觉的——但是悲伤的故事是，这个对于引用类型则部分不成立

```js
let a = [ 1 ];
let b = a;
a[0] = 2;
console.log(b[0]); // 2 （震撼一万年

a = [ 3 ];
console.log(b[0]); // 2
```

这个现象和`引用类型`，这个名称有关，实际上，引用类型持有的并不是对象本身，而是对对象的引用，因此将对象赋值给另外一个变量的时候，两个变量持有了对同一个对象的引用，因此对一个变量的修改会影响另外一个，因此我们可以这么理解上面这个过程

```js
let a = [ 1 ]; // 创建了一个数组 arr1 = [ 1 ], 这里我们用ref(x)来代表指向x的引用，即 a = ref(arr1)
let b = a; // 将a持有的引用拷贝一份给b，即 b = ref(arr1)
a[0] = 2; // 修改arr1 为 [ 2 ]
console.log(b[0]); // b 引用的也是 arr1 , 所以也同样变化了

a = [ 3 ]; // 创建了一个数组 arr2 = [ 3 ], a = ref(arr2)
console.log(b[0]); // 引用本身是值类型，所以 b 还是指向 arr1，因此不会跟着变化
```

## 对象的常见方法

### 遍历对象属性 Object.keys Object.values Object.entries

用`for in`遍历对象属性已经足够应付常见场景，不过，js还提供了一组用于和函数式api结合的方法

你可以使用`Object.keys`获取一个对象的所有属性名称组成的数组（`key`在这里翻译为键（来点键厨），有时候对象的属性名也被称为键名

```js
Object.keys({ a: 1 }) // [ "a" ]
```

`Object.values` 对应的可以获取一个对象的所有属性值称组成的数组

```js
Object.values({ a: 1 }) // [ 1 ]
```

随后js还提供了二合一的`Object.entries`，能获取由`[属性名，属性值]`元组构成的数组

```js
Object.entries({ a: 1 }) // [ [ "a", 1 ] ]
```

你可以使用 `for of` 来处理这几个函数返回的数组。

### 构造对象 Object.fromEntries

`Object.fromEntries`是`Object.entries`的逆运算

```js
Object.fromEntries([ [ "a", 1 ] ]) // { a: 1 }
```

### 对象赋值 Object.assign

`Object.assign(target, ...source)` 允许将一个或多个对象的属性赋值到目标对象上，例如这样

```js
Object.assign({ a: 1 }, { a: 2 }) // { a: 2 }
Object.assign({ a: 1 }, { b: 1 }, { a: 2 }) // { a: 2, b: 1 }
```

>一种编程技巧是，如果想要将两个对象合成为一个，并且不改变两个对象本身，可以用一个空对象作为目标
>```js
>const obj1 = { a: 1 };
>const obj2 = { a: 2 };
>Object.assign({}, obj1, obj2) // { a: 2 }
>```

更多细节参见[mdn文档](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
